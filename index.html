<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Control Center Audio - Centros</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg-main: radial-gradient(circle at top left, #e5e7eb, #f9fafb 55%);
      --bg-card: #ffffff;
      --bg-card-soft: #f3f4f6;
      --text-main: #020617;
      --text-muted: #6b7280;
      --border-soft: #d4d4d8;
      --shadow-soft: 0 14px 30px rgba(15, 23, 42, 0.18);
      --accent-red: #ff2440;
      --accent-blue: #1d4ed8;
      --accent-green: #16a34a;
      --accent-orange: #ea580c;
    }

    body.dark {
      --bg-main: radial-gradient(circle at top left, #1f2937, #020617 55%);
      --bg-card: #0b1120;
      --bg-card-soft: #020617;
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --border-soft: #1f2937;
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.65);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
    }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    body {
      background: var(--bg-main);
      color: var(--text-main);
      display: flex;
    }

    /* SIDEBAR */
    .sidebar {
      width: 250px;
      background: #020617;
      border-right: 1px solid #111827;
      padding: 18px 18px 24px;
      display: flex;
      flex-direction: column;
      gap: 24px;
      color: #e5e7eb;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-badge {
      width: 34px;
      height: 34px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #fee2e2, var(--accent-red));
      box-shadow: 0 0 20px rgba(239, 68, 68, 0.75);
    }

    .logo-text {
      display: flex;
      flex-direction: column;
    }

    .logo-title {
      font-weight: 700;
      font-size: 1.05rem;
    }

    .logo-subtitle {
      font-size: .7rem;
      color: #9ca3af;
    }

    .section-title {
      font-size: .75rem;
      text-transform: uppercase;
      color: #6b7280;
      letter-spacing: .12em;
      margin-bottom: 8px;
    }

    .nav-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 10px;
      border-radius: 999px;
      font-size: .88rem;
      color: #9ca3af;
      cursor: pointer;
      transition: all .18s ease;
    }

    .nav-item span.icon {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: #020617;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: .75rem;
    }

    /* En este m√≥dulo, el activo es CENTROS en rojo */
    .nav-item.active {
      background: linear-gradient(90deg, #ff2440, #fb7185);
      color: #111827;
      font-weight: 600;
    }

    .nav-item.active span.icon {
      background: rgba(15,23,42,0.2);
    }

    .nav-item:hover:not(.active) {
      background: rgba(31,41,55,0.9);
      color: #e5e7eb;
    }

    .sidebar-footer {
      margin-top: auto;
      font-size: .78rem;
      color: #9ca3af;
    }

    /* MAIN */
    .main {
      flex: 1;
      padding: 10px 18px 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 100vh;
      overflow: hidden;
    }

    .topbar {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .search-input-wrapper {
      flex: 1;
      position: relative;
    }

    .search-input {
      width: 100%;
      background: #ffffff;
      border-radius: 999px;
      padding: 8px 12px 8px 32px;
      border: 1px solid var(--border-soft);
      color: var(--text-main);
      font-size: .86rem;
      outline: none;
    }

    body.dark .search-input {
      background: #020617;
      border-color: #1f2937;
      color: #e5e7eb;
    }

    .search-input::placeholder {
      color: var(--text-muted);
    }

    .search-icon {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: .8rem;
      color: var(--text-muted);
    }

    .btn {
      border-radius: 999px;
      padding: 7px 12px;
      border: 1px solid transparent;
      font-size: .8rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #e5e7eb;
      color: #111827;
      white-space: nowrap;
    }

    body.dark .btn {
      background: #020617;
      border-color: #1f2937;
      color: #e5e7eb;
    }

    .btn-cta {
      background: linear-gradient(90deg, var(--accent-red), #fb7185);
      color: #111827;
      font-weight: 600;
      box-shadow: 0 10px 24px rgba(248, 113, 113, 0.6);
    }

    .btn span.icon {
      font-size: .85rem;
    }

    #themeToggle {
      min-width: 110px;
      justify-content: center;
    }

    /* Buscador principal Centros */
    .centros-search-row {
      margin-top: 6px;
    }

    .centros-search-input {
      width: 100%;
      background: var(--bg-card);
      border-radius: 999px;
      padding: 9px 12px 9px 32px;
      border: 1px solid var(--border-soft);
      color: var(--text-main);
      font-size: .86rem;
      outline: none;
    }

    body.dark .centros-search-input {
      background: #020617;
      border-color: #1f2937;
      color: #e5e7eb;
    }

    .centros-search-input::placeholder {
      color: var(--text-muted);
    }

    .centros-search-wrapper {
      position: relative;
    }

    .centros-search-wrapper .search-icon {
      left: 10px;
      color: var(--text-muted);
    }

    .top-layout {
      display: grid;
      grid-template-columns: 1.3fr 1fr;
      gap: 8px;
      min-height: 180px;
    }

    .card {
      background: var(--bg-card);
      border-radius: 14px;
      padding: 10px 10px 8px;
      border: 1px solid var(--border-soft);
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      min-width: 0;
    }

    .card h3 {
      font-size: .9rem;
      margin-bottom: 4px;
    }

    .card-sub {
      font-size: .72rem;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    /* Mapa est√°tico */
    .map-container {
      flex: 1;
      position: relative;
      background: #111827;
      border-radius: 12px;
      padding: 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .map-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #e5e7eb;
      font-size: .8rem;
    }

    .map-body {
      flex: 1;
      position: relative;
      border-radius: 10px;
      background: radial-gradient(circle at 30% 20%, #4b5563, #020617);
      overflow: hidden;
    }

    .spain-label {
      position: absolute;
      bottom: 6px;
      right: 10px;
      font-size: .7rem;
      color: #e5e7eb;
      opacity: .7;
    }

    .map-dot {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 999px;
      cursor: pointer;
      border: 1px solid rgba(15,23,42,0.8);
    }

    .map-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 6px;
    }

    .map-legend-item {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: .7rem;
      color: #e5e7eb;
    }

    .map-legend-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
    }

    /* Panel derecho: A√±adir centro */
    .add-center-panel {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .add-center-panel-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .add-center-panel-top h3 {
      font-size: .9rem;
    }

    .add-center-text {
      font-size: .75rem;
      color: var(--text-muted);
    }

    .badge-type {
      border-radius: 999px;
      padding: 2px 6px;
      font-size: .7rem;
      background: rgba(37,99,235,0.09);
      color: #1d4ed8;
    }

    /* Tabla tipo Excel */
    .table-wrapper {
      flex: 1;
      background: var(--bg-card);
      border-radius: 14px;
      border: 1px solid var(--border-soft);
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .table-header {
      padding: 8px 10px 6px;
      display: flex;
      justify-content: space-between;
      align-items: baseline;
    }

    .table-header h3 {
      font-size: .9rem;
    }

    .table-header span {
      font-size: .72rem;
      color: var(--text-muted);
    }

    .table-scroll {
      flex: 1;
      overflow: auto;
      border-top: 1px solid var(--border-soft);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: .78rem;
    }

    thead {
      position: sticky;
      top: 0;
      background: var(--bg-card);
      z-index: 2;
    }

    th, td {
      padding: 6px 8px;
      border-bottom: 1px solid var(--bg-card-soft);
      text-align: left;
      white-space: nowrap;
    }

    th {
      font-weight: 600;
      font-size: .75rem;
      color: var(--text-muted);
    }

    tbody tr:nth-child(even) {
      background: var(--bg-card-soft);
    }

    tbody tr:hover {
      background: rgba(2,6,23,0.06);
    }

    body.dark tbody tr:nth-child(even) {
      background: #020617;
    }

    .tag {
      border-radius: 999px;
      padding: 2px 6px;
      font-size: .7rem;
      border: 1px solid var(--border-soft);
      background: var(--bg-card-soft);
    }

    .tag.exclusivo {
      background: rgba(22,163,74,0.12);
      color: var(--accent-green);
      border-color: rgba(22,163,74,0.6);
    }

    .tag.corner {
      background: rgba(37,99,235,0.12);
      color: var(--accent-blue);
      border-color: rgba(37,99,235,0.6);
    }

    .tag-aar {
      background: rgba(148,163,184,0.12);
      border-color: rgba(148,163,184,0.7);
      color: var(--text-muted);
    }

    .tag-aar.si {
      background: rgba(34,197,94,0.12);
      border-color: rgba(34,197,94,0.7);
      color: var(--accent-green);
    }

    .tag-aar.formacion {
      background: rgba(234,179,8,0.12);
      border-color: rgba(234,179,8,0.7);
      color: #eab308;
    }

    .btn-link {
      border: none;
      background: transparent;
      color: var(--accent-blue);
      cursor: pointer;
      font-size: .74rem;
      text-decoration: underline;
    }

    /* Modal a√±adir centro / ver informes */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.65);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }

    .modal {
      background: var(--bg-card);
      border-radius: 14px;
      padding: 14px;
      width: 420px;
      max-width: 95%;
      border: 1px solid var(--border-soft);
      box-shadow: var(--shadow-soft);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .modal-header h3 {
      font-size: .95rem;
    }

    .modal-close {
      cursor: pointer;
      font-size: 1rem;
      color: var(--text-muted);
    }

    .modal-body {
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: .78rem;
    }

    .modal-field {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .modal-field label {
      font-size: .74rem;
      color: var(--text-muted);
    }

    .modal-field input,
    .modal-field select {
      padding: 5px 7px;
      border-radius: 8px;
      border: 1px solid var(--border-soft);
      background: var(--bg-card-soft);
      color: var(--text-main);
      font-size: .78rem;
      outline: none;
    }

    body.dark .modal-field input,
    body.dark .modal-field select {
      background: #020617;
      border-color: #1f2937;
      color: #e5e7eb;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 10px;
    }

    .badge-small {
      font-size: .7rem;
      padding: 2px 5px;
      border-radius: 999px;
      background: rgba(148,163,184,0.15);
      color: var(--text-muted);
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="dark">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="logo">
      <div class="logo-badge"></div>
      <div class="logo-text">
        <span class="logo-title">Control Center Audio</span>
        <span class="logo-subtitle">Gesti√≥n de centros y delegados</span>
      </div>
    </div>

    <div>
      <div class="section-title">Secciones</div>
      <nav class="nav-list">
        <div class="nav-item">
          <span class="icon">üè†</span> Dashboard
        </div>
        <div class="nav-item active">
          <span class="icon">üè¢</span> Centros
        </div>
        <div class="nav-item">
          <span class="icon">üë£</span> Visitas
        </div>
        <div class="nav-item">
          <span class="icon">üõ†</span> Servicios
        </div>
        <div class="nav-item">
          <span class="icon">üí≥</span> Ventas
        </div>
        <div class="nav-item">
          <span class="icon">üìä</span> Proyectos
        </div>
      </nav>
    </div>

    <div class="sidebar-footer">
      <p>Versi√≥n demo ¬∑ Datos ficticios</p>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <!-- Topbar -->
    <div class="topbar">
      <div class="search-input-wrapper">
        <span class="search-icon">üîç</span>
        <input class="search-input" placeholder="Busca en toda la plataforma..." />
      </div>
      <button class="btn" id="themeToggle">
        <span class="icon">üåì</span> Oscuro / Claro
      </button>
      <button class="btn">
        <span class="icon">üíæ</span> Guardar vista
      </button>
      <button class="btn">
        <span class="icon">‚¨áÔ∏è</span> Exportar HTML
      </button>
      <button class="btn btn-cta">
        <span class="icon">‚òÅÔ∏è</span> Actualizar datos nube
      </button>
    </div>

    <!-- Buscador Centros -->
    <div class="centros-search-row">
      <div class="centros-search-wrapper">
        <span class="search-icon">üîç</span>
        <input id="buscadorCentros" class="centros-search-input"
               placeholder="Buscar por centro, propietario o delegado..." />
      </div>
    </div>

    <!-- Mapa + panel A√±adir centro -->
    <section class="top-layout">
      <!-- Mapa fijo Espa√±a -->
      <article class="card">
        <div class="map-container">
          <div class="map-title-row">
            <span>Mapa de delegados (est√°tico)</span>
            <span class="badge-small">Clic en un punto para filtrar</span>
          </div>
          <div class="map-body" id="mapSpain">
            <!-- Puntos est√°ticos aproximados por zona (sin zoom) -->
            <!-- Norte (Eneritz / Sonia / Sergio / Daniel / etc.) -->
            <div class="map-dot" data-delegado="Eneritz Aranguren"
                 style="top: 20%; left: 50%; background:#22c55e;"></div>
            <div class="map-dot" data-delegado="Sonia Godino"
                 style="top: 17%; left: 45%; background:#22d3ee;"></div>
            <div class="map-dot" data-delegado="Sergio Per√°n"
                 style="top: 25%; left: 40%; background:#fb7185;"></div>
            <div class="map-dot" data-delegado="Daniel Chazo"
                 style="top: 30%; left: 35%; background:#a855f7;"></div>

            <!-- Catalu√±a / Arag√≥n / Levante -->
            <div class="map-dot" data-delegado="Laura Plazas"
                 style="top: 32%; left: 60%; background:#2563eb;"></div>
            <div class="map-dot" data-delegado="Cecilia P√©rez"
                 style="top: 40%; left: 58%; background:#0ea5e9;"></div>

            <!-- Centro -->
            <div class="map-dot" data-delegado="Marisa Carmona"
                 style="top: 40%; left: 42%; background:#eab308;"></div>
            <div class="map-dot" data-delegado="Laura Ramos"
                 style="top: 43%; left: 44%; background:#14b8a6;"></div>
            <div class="map-dot" data-delegado="Blanca Fdez. de la Pradilla"
                 style="top: 38%; left: 46%; background:#ec4899;"></div>

            <!-- Sur / Andaluc√≠a / Extremadura -->
            <div class="map-dot" data-delegado="Martin Sebasti√°n"
                 style="top: 55%; left: 40%; background:#ef4444;"></div>
            <div class="map-dot" data-delegado="Maribel Amezcua"
                 style="top: 52%; left: 35%; background:#facc15;"></div>

            <!-- Islas / otros puntos aproximados -->
            <div class="map-dot" data-delegado="Cecilia P√©rez"
                 style="top: 72%; left: 48%; background:#0ea5e9;"></div>

            <span class="spain-label">Espa√±a ¬∑ Mapa est√°tico</span>
          </div>

          <div class="map-legend" id="mapLegend"></div>
        </div>
      </article>

      <!-- Panel derecho: A√±adir centro -->
      <article class="card add-center-panel">
        <div class="add-center-panel-top">
          <div>
            <h3>Gesti√≥n de centros</h3>
            <p class="add-center-text">
              Alta de nuevos centros, revisi√≥n de delegados y estado AAR.
            </p>
          </div>
          <button class="btn btn-cta" id="btnAddCentro">
            <span class="icon">‚ûï</span> A√±adir centro
          </button>
        </div>
        <div style="margin-top:6px;">
          <span class="badge-type">Corner</span>
          <span style="margin-left:6px;" class="badge-type"
                >Exclusivo (alto potencial)</span>
        </div>
        <p class="add-center-text" style="margin-top:8px;">
          Desde aqu√≠ podr√°s adjuntar informes a cada centro (puede haber varios por
          centro) y consultar en un clic qu√© informes tiene asociados.
        </p>
      </article>
    </section>

    <!-- Tabla tipo Excel -->
    <section class="table-wrapper">
      <div class="table-header">
        <div>
          <h3>Listado de centros</h3>
          <span>Vista consolidada de centros Corner y Exclusivos ¬∑ datos procedentes del Excel maestro.</span>
        </div>
        <span class="badge-small" id="totalCentrosLabel"></span>
      </div>
      <div class="table-scroll">
        <table>
          <thead>
            <tr>
              <th>C√≥digo</th>
              <th>Propietario</th>
              <th>Centro</th>
              <th>Provincia</th>
              <th>Delegado</th>
              <th>Tipo</th>
              <th>Informes</th>
              <th>Centro AAR</th>
            </tr>
          </thead>
          <tbody id="tablaCentrosBody"></tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- Modal A√±adir centro -->
  <div class="modal-backdrop" id="modalCentro">
    <div class="modal">
      <div class="modal-header">
        <h3>Nuevo centro</h3>
        <span class="modal-close" data-close="modalCentro">‚úï</span>
      </div>
      <div class="modal-body">
        <div class="modal-field">
          <label>C√≥digo</label>
          <input id="nuevoCodigo" />
        </div>
        <div class="modal-field">
          <label>Propietario</label>
          <input id="nuevoPropietario" />
        </div>
        <div class="modal-field">
          <label>Centro</label>
          <input id="nuevoCentro" />
        </div>
        <div class="modal-field">
          <label>Provincia</label>
          <input id="nuevoProvincia" />
        </div>
        <div class="modal-field">
          <label>Delegado</label>
          <select id="nuevoDelegado"></select>
        </div>
        <div class="modal-field">
          <label>Tipo</label>
          <select id="nuevoTipo">
            <option value="Corner">Corner</option>
            <option value="Exclusivo">Exclusivo</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" data-close="modalCentro">Cancelar</button>
        <button class="btn btn-cta" id="guardarCentro">Guardar centro</button>
      </div>
    </div>
  </div>

  <!-- Modal ver informes -->
  <div class="modal-backdrop" id="modalInformes">
    <div class="modal">
      <div class="modal-header">
        <h3>Informes del centro</h3>
        <span class="modal-close" data-close="modalInformes">‚úï</span>
      </div>
      <div class="modal-body" id="informesBody">
        <!-- listado din√°mico -->
      </div>
      <div class="modal-footer">
        <button class="btn" data-close="modalInformes">Cerrar</button>
      </div>
    </div>
  </div>

  <script>
    // ----- MODO OSCURO / CLARO -----
    document.getElementById('themeToggle').addEventListener('click', () => {
      document.body.classList.toggle('dark');
    });

    // ----- DELEGADOS Y COLORES (coherentes con dashboard) -----
    const delegadosColores = {
      "Eneritz ARANGUREN": "#22c55e",
      "Laura PLAZAS": "#2563eb",
      "Laura RAMOS": "#14b8a6",
      "Daniel Chazo": "#a855f7",
      "Manuel C√°novas": "#f97316",
      "Cecilia P√©rez": "#0ea5e9",
      "Martin SEBASTI√ÅN": "#ef4444",
      "Marisa Carmona": "#eab308",
      "Blanca Fdez. de la Pradilla": "#ec4899",
      "Maribel Amezcua": "#facc15",
      "Sonia Godino": "#22d3ee",
      "Ver√≥nica Alfons√≠n": "#4ade80",
      "Sergio Per√°n": "#fb7185"
    };

    // ----- CENTROS (muestra representativa construida a partir del Excel) -----
    // NOTA: aqu√≠ he cargado algunos como ejemplo. Puedes extender este array con todos los del Excel.
    const centros = [
      { codigo:"4DIA", propietario:"AAO", centro:"AVENIDA DIAGONAL", provincia:"BARCELONA", delegado:"ENERITZ ARANGUREN" },
      { codigo:"4AXA", propietario:"VADILLO Pedro", centro:"CERDANYOLA", provincia:"BARCELONA", delegado:"LAURA PLAZAS" },
      { codigo:"4AES", propietario:"FRAGUELA Jacobo", centro:"AAA NAR√ìN", provincia:"Galicia", delegado:"Daniel Chazo" },
      { codigo:"4ADX", propietario:"LOPEZ Jose", centro:"AGUILAS", provincia:"MURCIA", delegado:"Manuel C√°novas" },
      { codigo:"4ARK", propietario:"BELLOT Sonia", centro:"ALAIN AFFLELOU OPTICO CARLET", provincia:"VALENCIA", delegado:"Cecilia P√©rez" },
      { codigo:"4AQU", propietario:"RUIZ Alberto", centro:"ALCOBENDAS CONSTITUCION", provincia:"MADRID", delegado:"LAURA RAMOS" },
      { codigo:"4AKI", propietario:"PIEDRAFITA Rocio", centro:"CC LOS VALLES", provincia:"MADRID", delegado:"Blanca Fdez. de la Pradilla" },
      { codigo:"4MLG", propietario:"AAO", centro:"FUENLABRADA Calle Leganes", provincia:"MADRID", delegado:"Marisa Carmona" },
      { codigo:"4ABB", propietario:"MAZA Oriol", centro:"PAMPLONA C. Exclusivo", provincia:"NAVARRA", delegado:"Sonia Godino" },
      { codigo:"4AFH", propietario:"MAZA Oriol", centro:"PAMPLONA Calle Sancho el Mayor", provincia:"NAVARRA", delegado:"Sonia Godino" },
      { codigo:"4AWQ", propietario:"MAZA Oriol", centro:"PAMPLONA Carlos III", provincia:"NAVARRA", delegado:"Sonia Godino" },
      { codigo:"4MRM", propietario:"AAO", centro:"REINA DE MERCEDES", provincia:"Madrid", delegado:"Sergio Per√°n" },
      { codigo:"4PEC", propietario:"AAO", centro:"SANTANDER CC PE√ëACASTILLO", provincia:"Santander", delegado:"Sergio Per√°n" },
      { codigo:"4AXF", propietario:"URRUTIA Esteban", centro:"SANTIAGO DE COMPOSTELA RUA DA ROSA", provincia:"Santiago de Compostela", delegado:"Daniel Chazo" },
      { codigo:"4TOL", propietario:"AAO", centro:"TORRELAVEGA CARREFOUR CC", provincia:"Santander", delegado:"Sergio Per√°n" },
      { codigo:"4ZDE", propietario:"AAO", centro:"ZARAGOZA CALLE DELICIAS", provincia:"ZARAGOZA", delegado:"ENERITZ ARANGUREN" },
      // ... aqu√≠ puedes seguir pegando todas las filas del Excel si quieres tener el 100% de centros
    ];

    // Centros exclusivos (los que nos has pasado en el listado de ejemplo)
    const exclusivosNombres = new Set([
      "CC LOS VALLES",
      "FUENLABRADA Calle Leganes",
      "PAMPLONA C. Exclusivo",
      "PAMPLONA Calle Sancho el Mayor",
      "PAMPLONA Carlos III",
      "REINA DE MERCEDES",
      "SANTANDER CC PE√ëACASTILLO",
      "SANTIAGO DE COMPOSTELA RUA DA ROSA",
      "TORRELAVEGA CARREFOUR CC",
      "ZARAGOZA CALLE DELICIAS"
    ]);

    // Informes por centro (demo: varios informes posibles)
    const informesPorCentro = {
      "CC LOS VALLES": ["Informe inicial 2024-01", "Seguimiento procesos 2024-06"],
      "REINA DE MERCEDES": ["Auditor√≠a HIT 2024-Q2"],
      "PAMPLONA C. Exclusivo": ["Apertura 2023", "Plan de acci√≥n 2024"],
      "SANTANDER CC PE√ëACASTILLO": []
    };

    // Estado AAR (demo)
    const aarPorCentro = {
      "REINA DE MERCEDES": "S√≠",
      "PAMPLONA C. Exclusivo": "En formaci√≥n",
      "SANTIAGO DE COMPOSTELA RUA DA ROSA": "En formaci√≥n"
      // resto quedan como "No"
    };

    // ----- RENDER TABLA -----
    const tablaBody = document.getElementById('tablaCentrosBody');
    const totalCentrosLabel = document.getElementById('totalCentrosLabel');

    function tipoCentro(nombreCentro) {
      return exclusivosNombres.has(nombreCentro) ? "Exclusivo" : "Corner";
    }

    function getInformes(nombreCentro) {
      return informesPorCentro[nombreCentro] || [];
    }

    function getAarEstado(nombreCentro) {
      return aarPorCentro[nombreCentro] || "No";
    }

    function renderTabla(filtroTexto = "", filtroDelegado = null) {
      const texto = filtroTexto.toLowerCase();
      tablaBody.innerHTML = "";

      let datosFiltrados = centros.filter(c => {
        const cad = (c.centro + " " + c.propietario + " " + c.delegado).toLowerCase();
        const pasaTexto = cad.includes(texto);
        const pasaDelegado = !filtroDelegado || c.delegado.toLowerCase().includes(filtroDelegado.toLowerCase());
        return pasaTexto && pasaDelegado;
      });

      datosFiltrados.forEach(c => {
        const tr = document.createElement('tr');
        const t = tipoCentro(c.centro);
        const informes = getInformes(c.centro);
        const aarEstado = getAarEstado(c.centro);

        tr.innerHTML = `
          <td>${c.codigo}</td>
          <td>${c.propietario}</td>
          <td>${c.centro}</td>
          <td>${c.provincia}</td>
          <td>${c.delegado}</td>
          <td><span class="tag ${t === 'Exclusivo' ? 'exclusivo' : 'corner'}">${t}</span></td>
          <td>
            <button class="btn-link" data-centro="${c.centro}">
              ${informes.length ? `Ver (${informes.length})` : "A√±adir informe"}
            </button>
          </td>
          <td>
            <span class="tag tag-aar ${
              aarEstado === 'S√≠' ? 'si' :
              aarEstado === 'En formaci√≥n' ? 'formacion' : ''
            }">${aarEstado}</span>
          </td>
        `;
        tablaBody.appendChild(tr);
      });

      totalCentrosLabel.textContent = `Centros mostrados: ${datosFiltrados.length} / ${centros.length}`;
    }

    renderTabla();

    // ----- BUSCADOR PRINCIPAL -----
    document.getElementById('buscadorCentros').addEventListener('input', e => {
      renderTabla(e.target.value, filtroDelegadoActual);
    });

    // ----- MAPA: leyenda y filtro por clic en punto -----
    const mapLegend = document.getElementById('mapLegend');
    Object.entries(delegadosColores).forEach(([nombre, color]) => {
      const item = document.createElement('div');
      item.className = 'map-legend-item';
      item.innerHTML = `<span class="map-legend-dot" style="background:${color}"></span>${nombre}`;
      mapLegend.appendChild(item);
    });

    let filtroDelegadoActual = null;

    document.querySelectorAll('.map-dot').forEach(dot => {
      dot.addEventListener('click', () => {
        const del = dot.dataset.delegado;
        filtroDelegadoActual = del;
        renderTabla(document.getElementById('buscadorCentros').value, del);
      });
    });

    // ----- MODALES -----
    function abrirModal(id) {
      document.getElementById(id).style.display = 'flex';
    }
    function cerrarModal(id) {
      document.getElementById(id).style.display = 'none';
    }

    document.querySelectorAll('[data-close]').forEach(el => {
      el.addEventListener('click', () => cerrarModal(el.dataset.close));
    });

    // A√±adir centro
    document.getElementById('btnAddCentro').addEventListener('click', () => {
      // Rellenar select delegados
      const sel = document.getElementById('nuevoDelegado');
      sel.innerHTML = "";
      Object.keys(delegadosColores).forEach(nombre => {
        const opt = document.createElement('option');
        opt.value = nombre;
        opt.textContent = nombre;
        sel.appendChild(opt);
      });
      abrirModal('modalCentro');
    });

    document.getElementById('guardarCentro').addEventListener('click', () => {
      const nuevo = {
        codigo: document.getElementById('nuevoCodigo').value || "NEW",
        propietario: document.getElementById('nuevoPropietario').value || "N/D",
        centro: document.getElementById('nuevoCentro').value || "Centro sin nombre",
        provincia: document.getElementById('nuevoProvincia').value || "N/D",
        delegado: document.getElementById('nuevoDelegado').value || "N/D"
      };
      const tipo = document.getElementById('nuevoTipo').value;
      if (tipo === "Exclusivo") exclusivosNombres.add(nuevo.centro);
      centros.push(nuevo);
      cerrarModal('modalCentro');
      renderTabla(document.getElementById('buscadorCentros').value, filtroDelegadoActual);
    });

    // Click en botones de informes
    document.addEventListener('click', e => {
      if (e.target.matches('.btn-link[data-centro]')) {
        const nombreCentro = e.target.dataset.centro;
        const informes = getInformes(nombreCentro);
        const cont = document.getElementById('informesBody');
        cont.innerHTML = "";

        if (!informes.length) {
          cont.innerHTML = "<p style='font-size:.8rem;'>Este centro a√∫n no tiene informes guardados. Desde el m√≥dulo de informes podr√°s adjuntar documentos PDF, actas de visitas, etc.</p>";
        } else {
          informes.forEach((inf, idx) => {
            const div = document.createElement('div');
            div.className = 'modal-field';
            div.innerHTML = `<label>Informe ${idx + 1}</label><div>${inf}</div>`;
            cont.appendChild(div);
          });
        }
        abrirModal('modalInformes');
      }
    });
  </script>
</body>
</html>
